/**
 * plugin.js
 *
 * Copyright, Amir Swaleh
 * Released under Creative Commons Attribution-NonCommercial 3.0 Unported License.
 *
 * Contributing: https://github.com/Amiejah/live_cms
 */


tinymce.PluginManager.add('top_widget', function(editor) {

    // Create a function to retrieve the JSON data
    // This function only gets the data
    var getJSON = function( url, successHandler, errorHandler) {
        var xhr = typeof XMLHttpRequest != 'undefined' ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');

    xhr.open('get', url, true);
    xhr.onreadystatechange = function() {
        var status;
        var data;
        // http://xhr.spec.whatwg.org/#dom-xmlhttprequest-readystate
        if(xhr.readyState == 4) {
            // DONE
            status = xhr.status;
            if(status == 200) {
                data = JSON.parse(xhr.responseText);
                successHandler && successHandler(data);
            } else {
                errorHandler && errorHandler(status);
            }
        }
    };
      return xhr;
    };



    // Add a menu item to the toolbar
    editor.addMenuItem('top_widget', {
        text: 'Add Widget',
        context: 'tools',
        onclick: function(){
            tinymce.activeEditor.execCommand(
                'mceInsertContent',
                true,
                function(){
                    var getData = getJSON("/admin/casino/retrieve_data");
                    alert(getData);

                    var tbl  = '<table class="table">';
                        tbl += '<thead>';
                            tbl += '<tr>';
                                tbl += '<th>#</th>';
                                tbl += '<th>Casino</th>';
                                tbl += '<th>Rating</th>';
                                tbl += '<th>Welkomst bonus</th>';
                                tbl += '<th>Download/Review</th>';
                            tbl += '</tr>';
                        tbl += '</thead>';
                        tbl += '<tbody>';
                            tbl += '<tr>';
                                tbl += '<td>1</td>';
                                tbl += '<td>Eurogrande Casino</td>';
                                tbl += '<td>Rating</td>';
                                tbl += '<td>100% bonus</td>';
                                tbl += '<td>dowload/review</td>';
                            tbl += '</tr>';
                        tbl += '</tbody>';
                        tbl += '</table>';
                    return tbl;
                }
            );
        }
    });

});